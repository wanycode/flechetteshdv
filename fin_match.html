<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fin de Match - Championnat de Fl√©chettes</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<style>
body {
  background: radial-gradient(circle at top, #0d0d0d, #000);
  color: #f5f5f5;
  font-family: 'Poppins', sans-serif;
  min-height: 100vh;
  padding: 1rem;
  display:flex;
  flex-direction:column;
  align-items:center;
}
h1 {
  text-align:center;
  margin-bottom:30px;
  color:#00bcd4;
  text-shadow:0 0 10px #00bcd4;
  font-size:2rem;
}
.card {
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(10px);
  box-shadow: 0 0 25px rgba(255, 255, 255, 0.1);
  border-radius: 1rem;
  padding: 20px;
  margin-bottom:15px;
  transition: transform 0.5s ease, box-shadow 0.5s ease, opacity 0.5s ease;
  opacity: 0;
}
.card.show { opacity: 1; transform: translateY(0); }
.stats-title {
  font-size: 1.25rem;
  font-weight: bold;
  margin-bottom: 12px;
  color: #ffeb3b;
}
.gagnant {
  background: linear-gradient(90deg, #FFD700, #FFC107);
  color: #000;
  text-shadow: none;
  font-size: 1.5rem;
  padding: 15px;
  border-radius: 1rem;
  margin-bottom: 20px;
}
.stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-bottom: 20px;
}
canvas { background: rgba(0,0,0,0.2); border-radius: 1rem; padding: 10px; margin-bottom: 20px; }
button {
  background: linear-gradient(90deg, #00bcd4, #007bff);
  border-radius: 8px;
  font-weight: 600;
  color: white;
  padding: 10px 20px;
  margin-top: 20px;
}
button:hover {
  background: linear-gradient(90deg, #007bff, #00bcd4);
  transform: scale(1.05);
}
</style>
</head>
<body>

<h1>üèÜ Fin du Match</h1>

<div class="stats-grid" id="statsContainer"></div>

<div class="card gagnant show" id="gagnantDiv">üèÖ Gagnant : </div>

<h2 class="mt-6 mb-2 text-yellow-300 text-xl">üìä Comparaison des stats</h2>
<canvas id="chartStats" class="w-full max-w-lg"></canvas>

<button onclick="location.href='index.html'">‚¨ÖÔ∏è Retour √† l‚Äôaccueil</button>

<script>
// R√©cup√©ration des donn√©es
const matchData = JSON.parse(localStorage.getItem("matchData") || "{}");
const stats = JSON.parse(localStorage.getItem("matchStats") || "[]");
const gagnant = localStorage.getItem("gagnant") || "√âgalit√©";

// V√©rification
if(!matchData.joueurs || matchData.joueurs.length < 2){
  alert("Donn√©es du match introuvables !");
  window.location.href = "nouveau-match.html";
}

// R√©cup√©ration des joueurs
const joueur1 = matchData.joueurs[0];
const joueur2 = matchData.joueurs[1];
const joueur3 = matchData.joueurs[2] || null;

// Cr√©ation cartes visuelles
const container = document.getElementById("statsContainer");
function creerCarteStats(s, nomJoueur, color){
  const div = document.createElement("div");
  div.className = "card";
  div.style.background = color;
  div.innerHTML = `
    <h2 class="stats-title">${nomJoueur}</h2>
    <p><strong>Score final :</strong> ${s.scoreFinal || 0}</p>
    <p><strong>Lancers :</strong> ${s.lancers || 0}</p>
    <p><strong>Moyenne par tour :</strong> ${s.lancers ? ((s.pts/s.lancers)*3).toFixed(1) : 0}</p>
    <p><strong>Doubles :</strong> ${s.doubles || 0}</p>
    <p><strong>Triples :</strong> ${s.triples || 0}</p>
  `;
  container.appendChild(div);
  setTimeout(()=>div.classList.add("show"),100);
}

// Cr√©ation cartes pour chaque joueur
creerCarteStats(stats[0] || {}, joueur1, "rgba(0, 188, 212,0.3)");
creerCarteStats(stats[1] || {}, joueur2, "rgba(0, 123, 255,0.3)");
if(joueur3) creerCarteStats(stats[2] || {}, joueur3, "rgba(156, 39, 176,0.3)");

// Gagnant
document.getElementById("gagnantDiv").textContent = "üèÖ Gagnant : " + gagnant;

// Graphique comparatif
const ctx = document.getElementById('chartStats').getContext('2d');
const labels = ['Score final', 'Lancers', 'Moyenne', 'Doubles', 'Triples'];
const datasets = [
  { label: joueur1, data: [
      stats[0]?.scoreFinal || 0,
      stats[0]?.lancers || 0,
      stats[0]?.lancers ? ((stats[0].pts/stats[0].lancers)*3).toFixed(1) : 0,
      stats[0]?.doubles || 0,
      stats[0]?.triples || 0
    ], backgroundColor: 'rgba(0, 188, 212, 0.7)' },
  { label: joueur2, data: [
      stats[1]?.scoreFinal || 0,
      stats[1]?.lancers || 0,
      stats[1]?.lancers ? ((stats[1].pts/stats[1].lancers)*3).toFixed(1) : 0,
      stats[1]?.doubles || 0,
      stats[1]?.triples || 0
    ], backgroundColor: 'rgba(0, 123, 255, 0.7)' }
];

if(joueur3){
  datasets.push({
    label: joueur3,
    data: [
      stats[2]?.scoreFinal || 0,
      stats[2]?.lancers || 0,
      stats[2]?.lancers ? ((stats[2].pts/stats[2].lancers)*3).toFixed(1) : 0,
      stats[2]?.doubles || 0,
      stats[2]?.triples || 0
    ],
    backgroundColor: 'rgba(156, 39, 176, 0.7)'
  });
}

new Chart(ctx, {
    type: 'bar',
    data: { labels, datasets },
    options: {
      responsive:true,
      plugins:{ 
        legend:{labels:{color:'#fff'} }, 
        title:{display:true,text:'Comparaison des stats',color:'#fff'} 
      },
      scales:{ x:{ticks:{color:'#fff'}}, y:{ticks:{color:'#fff'}, beginAtZero:true} }
    }
});
</script>
</body>
</html>
